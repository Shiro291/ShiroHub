local ShiroLib = {
    Flags = {},
    Theme = {
        Main = Color3.fromRGB(15, 15, 15),
        Accent = Color3.fromRGB(80, 160, 255),
        Text = Color3.fromRGB(255, 255, 255),
        ToggleOn = Color3.fromRGB(40, 140, 40),
        ToggleOff = Color3.fromRGB(140, 40, 40),
        Trans = 0.25
    }
}

local UIS, TS, CoreGui = game:GetService("UserInputService"), game:GetService("TweenService"), game:GetService("CoreGui")

local function Drag(obj)
    local drag, dInput, dStart, sPos
    obj.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then
            drag = true dStart = i.Position sPos = obj.Position
            i.Changed:Connect(function() if i.UserInputState == Enum.UserInputState.End then drag = false end end)
        end
    end)
    obj.InputChanged:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch then dInput = i end end)
    UIS.InputChanged:Connect(function(i)
        if i == dInput and drag then
            local delta = i.Position - dStart
            obj.Position = UDim2.new(sPos.X.Scale, sPos.X.Offset + delta.X, sPos.Y.Scale, sPos.Y.Offset + delta.Y)
        end
    end)
end

function ShiroLib:Notify(data)
    task.spawn(function()
        local n = Instance.new("Frame", CoreGui:FindFirstChild("ShiroLib_V4"))
        n.Size = UDim2.new(0, 200, 0, 45) n.Position = UDim2.new(1, 0, 0.9, 0)
        n.BackgroundColor3 = ShiroLib.Theme.Main n.BackgroundTransparency = 0.1
        Instance.new("UICorner", n)
        local l = Instance.new("TextLabel", n)
        l.Size = UDim2.new(1, -10, 1, 0) l.Position = UDim2.new(0, 5, 0, 0)
        l.Text = data.Title .. ": " .. data.Content l.TextColor3 = Color3.new(1,1,1)
        l.TextSize = 10 l.Font = Enum.Font.GothamBold l.BackgroundTransparency = 1
        n:TweenPosition(UDim2.new(1, -210, 0.9, 0), "Out", "Quart", 0.5)
        task.wait(data.Duration or 3)
        n:TweenPosition(UDim2.new(1, 0, 0.9, 0), "In", "Quart", 0.5)
        task.wait(0.5) n:Destroy()
    end)
end

function ShiroLib:CreateWindow(config)
    local SG = Instance.new("ScreenGui", CoreGui) SG.Name = "ShiroLib_V4" SG.DisplayOrder = 999
    
    local B = Instance.new("TextButton", SG)
    B.Size = UDim2.new(0, 45, 0, 45) B.Position = UDim2.new(0.05, 0, 0.1, 0)
    B.BackgroundColor3 = Color3.fromRGB(30, 30, 30) B.BackgroundTransparency = 0.3
    B.Text = "SH" B.TextColor3 = ShiroLib.Theme.Text B.Font = Enum.Font.GothamBold B.TextSize = 16
    Instance.new("UICorner", B).CornerRadius = UDim.new(1, 0)
    B.Draggable = true

    local M = Instance.new("Frame", SG)
    M.Size = UDim2.new(0, 240, 0, 350) M.Position = UDim2.new(0.5, -120, 0.5, -175)
    M.BackgroundColor3 = ShiroLib.Theme.Main M.BackgroundTransparency = ShiroLib.Theme.Trans
    M.Visible = false M.Active = true Instance.new("UICorner", M) Drag(M)

    local TList = Instance.new("Frame", M) TList.Size = UDim2.new(0, 60, 1, -10) TList.Position = UDim2.new(0, 5, 0, 5) TList.BackgroundTransparency = 1
    Instance.new("UIListLayout", TList).Padding = UDim.new(0, 5)

    local C = Instance.new("Frame", M) C.Size = UDim2.new(1, -75, 1, -10) C.Position = UDim2.new(0, 70, 0, 5) C.BackgroundTransparency = 1

    B.MouseButton1Click:Connect(function() M.Visible = not M.Visible end)

    local Win = {}
    function Win:CreateTab(name)
        local P = Instance.new("ScrollingFrame", C)
        P.Size = UDim2.new(1, 0, 1, 0) P.BackgroundTransparency = 1 P.Visible = false P.ScrollBarThickness = 0
        local PLayout = Instance.new("UIListLayout", P) PLayout.Padding = UDim.new(0, 5)
        
        PLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            P.CanvasSize = UDim2.new(0, 0, 0, PLayout.AbsoluteContentSize.Y + 10)
        end)

        local TBtn = Instance.new("TextButton", TList)
        TBtn.Size = UDim2.new(1, 0, 0, 30) TBtn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        TBtn.Text = name:sub(1,3):upper() TBtn.TextColor3 = Color3.new(0.6,0.6,0.6) TBtn.Font = Enum.Font.GothamBold TBtn.TextSize = 10 Instance.new("UICorner", TBtn)

        TBtn.MouseButton1Click:Connect(function()
            for _, v in pairs(C:GetChildren()) do if v:IsA("ScrollingFrame") then v.Visible = false end end
            for _, v in pairs(TList:GetChildren()) do if v:IsA("TextButton") then v.TextColor3 = Color3.new(0.6,0.6,0.6) end end
            P.Visible = true TBtn.TextColor3 = ShiroLib.Theme.Accent
        end)
        
        if #TList:GetChildren() == 2 then P.Visible = true TBtn.TextColor3 = ShiroLib.Theme.Accent end

        local Tab = {}
        
        -- Labels & Paragraphs
        function Tab:Label(text)
            local l = Instance.new("TextLabel", P) l.Size = UDim2.new(1, 0, 0, 20)
            l.BackgroundTransparency = 1 l.Text = text l.TextColor3 = Color3.fromRGB(180,180,180)
            l.Font = Enum.Font.Gotham l.TextSize = 10
        end

        function Tab:Section(text)
            local l = Instance.new("TextLabel", P) l.Size = UDim2.new(1, 0, 0, 30)
            l.BackgroundTransparency = 1 l.Text = "--- " .. text:upper() .. " ---" l.TextColor3 = ShiroLib.Theme.Accent
            l.Font = Enum.Font.GothamBold l.TextSize = 11
        end

        -- Interactions
        function Tab:Button(data)
            local b = Instance.new("TextButton", P) b.Size = UDim2.new(1, 0, 0, 30) b.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
            b.Text = data.Name b.TextColor3 = Color3.new(1,1,1) b.Font = Enum.Font.GothamBold b.TextSize = 10 Instance.new("UICorner", b)
            b.MouseButton1Click:Connect(data.Callback)
        end

        function Tab:Toggle(data)
            local s = data.CurrentValue or false
            if data.Flag then ShiroLib.Flags[data.Flag] = s end
            local t = Instance.new("TextButton", P) t.Size = UDim2.new(1, 0, 0, 30) t.Font = Enum.Font.GothamBold t.TextSize = 10 Instance.new("UICorner", t)
            local function Upd() t.Text = data.Name .. ": " .. (s and "ON" or "OFF") t.BackgroundColor3 = s and ShiroLib.Theme.ToggleOn or ShiroLib.Theme.ToggleOff end
            t.MouseButton1Click:Connect(function() s = not s if data.Flag then ShiroLib.Flags[data.Flag] = s end Upd() data.Callback(s) end)
            Upd()
        end

        function Tab:Input(data) -- Essential for manual delays
            local i = Instance.new("TextBox", P) i.Size = UDim2.new(1, 0, 0, 30)
            i.BackgroundColor3 = Color3.fromRGB(35, 35, 35) i.Text = "" i.PlaceholderText = data.Name .. "..."
            i.TextColor3 = Color3.new(1,1,1) i.Font = Enum.Font.GothamBold i.TextSize = 10 Instance.new("UICorner", i)
            i.FocusLost:Connect(function() if data.Flag then ShiroLib.Flags[data.Flag] = i.Text end data.Callback(i.Text) end)
        end

        function Tab:Slider(data)
            local min, max, cur = data.Range[1], data.Range[2], data.CurrentValue
            local f = Instance.new("Frame", P) f.Size = UDim2.new(1, 0, 0, 35) f.BackgroundColor3 = Color3.fromRGB(35, 35, 35) Instance.new("UICorner", f)
            local l = Instance.new("TextLabel", f) l.Size = UDim2.new(1, 0, 0, 20) l.Text = data.Name .. ": " .. cur l.TextColor3 = Color3.new(1,1,1) l.BackgroundTransparency = 1 l.Font = Enum.Font.GothamBold l.TextSize = 9
            local b = Instance.new("Frame", f) b.Size = UDim2.new(0.8, 0, 0, 4) b.Position = UDim2.new(0.1, 0, 0.7, 0) b.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            local fi = Instance.new("Frame", b) fi.Size = UDim2.new((cur-min)/(max-min), 0, 1, 0) fi.BackgroundColor3 = ShiroLib.Theme.Accent
            local drag = false
            local function UpdSlide()
                local p = math.clamp((UIS:GetMouseLocation().X - b.AbsolutePosition.X) / b.AbsoluteSize.X, 0, 1)
                local v = math.floor(min + (max - min) * p)
                fi.Size = UDim2.new(p, 0, 1, 0) l.Text = data.Name .. ": " .. v
                if data.Flag then ShiroLib.Flags[data.Flag] = v end data.Callback(v)
            end
            b.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then drag = true end end)
            UIS.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then drag = false end end)
            UIS.InputChanged:Connect(function(i) if drag and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then UpdSlide() end end)
        end

        function Tab:Dropdown(data)
            local dF = Instance.new("Frame", P) dF.Size = UDim2.new(1, 0, 0, 30) dF.BackgroundColor3 = Color3.fromRGB(30, 30, 30) dF.ClipsDescendants = true Instance.new("UICorner", dF)
            local dB = Instance.new("TextButton", dF) dB.Size = UDim2.new(1, 0, 0, 30) dB.Text = data.Name .. ": SELECT" dB.TextColor3 = Color3.new(1,1,1) dB.BackgroundTransparency = 1 dB.Font = Enum.Font.GothamBold dB.TextSize = 10
            dB.MouseButton1Click:Connect(function() 
                dF.Size = dF.Size.Y.Offset == 30 and UDim2.new(1, 0, 0, 30 + (#data.Options * 25)) or UDim2.new(1, 0, 0, 30) 
                P.CanvasSize = UDim2.new(0,0,0,PLayout.AbsoluteContentSize.Y + 10) 
            end)
            for _, v in pairs(data.Options) do
                local o = Instance.new("TextButton", dF) o.Size = UDim2.new(1, 0, 0, 25) o.Position = UDim2.new(0, 0, 0, 30 + ((_ - 1) * 25)) o.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
                o.Text = tostring(v) o.TextColor3 = Color3.new(0.8,0.8,0.8) o.Font = Enum.Font.Gotham o.TextSize = 9
                o.MouseButton1Click:Connect(function() dB.Text = data.Name .. ": " .. v dF.Size = UDim2.new(1, 0, 0, 30) if data.Flag then ShiroLib.Flags[data.Flag] = v end data.Callback(v) end)
            end
        end

        return Tab
    end
    return Win
end

return ShiroLib
